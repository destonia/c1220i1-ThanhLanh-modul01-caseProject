<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meteor Defence</title>
    <script src="js/meteor.js"></script>
    <script src="js/barrier.js"></script>
    <style>
        table {
            border: solid black;
            width: 400px;
            border-collapse: collapse;
        }

        th, tr, td {
            border: solid black;

        }

        img {
            display: none;
        }
    </style>
</head>
<body>
<canvas id="canvas1" width="400px" height="400px" style="background-color: pink"></canvas>
<!--<button type="button" onclick="start()">start</button>-->
<table id="scoreBoard">
    <tr>
        <th>Name</th>
        <th>Point</th>
    </tr>
    <tr>
        <td id="name"></td>
        <td id="point"></td>
    </tr>
</table>
<img src="images/barrier.png" id="barrierImg">
<img src="images/town.png" id="townImg">
<img src="images/meteor.png" id="meteorImg">
<button type="button" onclick="start()">start</button>
<button type="button" onclick="restart()">restart</button>
</body>
<script>
    loadData();
    let scoreBoard = loadData();
    let barrierImg = document.getElementById('barrierImg');
    let townImg = document.getElementById('townImg');
    let meteorImg = document.getElementById('meteorImg');
    let name = [];
    let score = 0;
    let canvas = document.getElementById('canvas1');
    let ctx = canvas.getContext("2d");

    let meteors = new Meteor();
    let barrier = new Barrier(100, 20)
    barrier.init(canvas);

    function drawScore() {
        ctx.fillStyle = "#ffffff"
        ctx.font = "30px Arial";
        ctx.fillText("Point: " + score, 150, 100);
    }

    function clearSky() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)
    }

    function drawGameOver() {
        clearInterval(timerId);
        drawSky();
        ctx.fillStyle = "#ffffff";
        ctx.font = "30px Arial";
        ctx.fillText("Game Over", 150, 100);
    }

    function drawSky() {
        ctx.drawImage(townImg, 0, 0, 400, 400)
    }

    function draw() {
        drawSky();
        drawObject();
    }

    function drawObject() {
        meteors.render(canvas);
        barrier.render(canvas);
        drawScore();
    }

    function start() {
        //getName();
        timerId = setInterval(loop, 20);
    }

    function restart(){
        //location.reload();
        clearInterval(timerId);
        timerId = setInterval(loop, 20);
    }

    function loop() {
        meteors.update();
        draw();
    }

    function getPoint() {
        document.getElementById('point').innerHTML = score + 1;
    }

    function getName() {
        name = prompt('tell me your name');
        document.getElementById('name').innerHTML = name;
    }

    function saveData() {
        localStorage.setItem('name', JSON.stringify(scoreBoard));
    }

    function loadData() {
        if (localStorage.hasOwnProperty('name')) {
            let data = JSON.parse(localStorage.getItem('name'));
            return data;
        } else {
            return [];
        }
    }

    //drawGameOver();
    //getName();
    //start();
    //let timerId = setInterval(loop, 20);
</script>
</html>
